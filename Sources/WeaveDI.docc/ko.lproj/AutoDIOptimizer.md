# 자동 DI 최적화

자동으로 의존성 그래프를 생성하고 성능을 최적화하는 시스템

## 개요

WeaveDI는 별도 설정 없이 자동으로 의존성 관계를 추적하고 성능을 최적화하는 시스템을 제공합니다. 개발자가 신경쓰지 않아도 백그라운드에서 자동으로 실행됩니다.

## 자동 기능들

### 🔄 자동 의존성 그래프 생성

의존성을 등록하거나 해결할 때마다 자동으로 그래프가 업데이트됩니다.

```swift
// 등록하기만 하면 자동으로 그래프에 추가
let service = UnifiedDI.register(UserService.self) {
    UserServiceImpl()
}

// 자동 생성된 그래프는 LogMacro로 자동 출력됩니다
// 별도 호출 불필요 - 자동 로깅: 📊 Auto tracking registration: UserService
```

### 🎯 자동 Actor Hop 감지 및 최적화

의존성 해결 시 자동으로 Actor hop 패턴을 감지하고 최적화 제안을 제공합니다.

```swift
// 해결하기만 하면 자동으로 Actor hop 감지
let service = UnifiedDI.resolve(UserService.self)

// 자동 로그 (5회 이상 hop 발생 시):
// 🎯 Actor optimization suggestion for UserService: MainActor로 이동 권장 (hops: 12, avg: 85.3ms)
```

### 🔒 자동 타입 안전성 검증

런타임에서 타입 안전성 문제를 자동으로 감지하고 안전하게 처리합니다.

```swift
// 해결 시 자동으로 타입 안전성 검증
let service = UnifiedDI.resolve(UserService.self)

// 자동 로그 (문제 감지 시):
// 🔒 Type safety issue: UserService is not Sendable
// 🚨 Auto safety check: UserService resolved to nil - dependency not registered
```

### ⚡ 자동 성능 최적화

사용 패턴을 분석하여 자주 사용되는 타입을 자동으로 최적화합니다.

```swift
// 여러 번 사용하면 자동으로 최적화됨
for _ in 1...15 {
    let service = UnifiedDI.resolve(UserService.self)
}

// 최적화된 타입들은 자동으로 로깅됩니다
// 자동 로그: ⚡ Auto optimized: UserService (10 uses)
```

### 📊 자동 사용 통계 수집

각 타입의 사용 빈도가 자동으로 추적됩니다.

```swift
// 사용 통계는 30초마다 자동으로 로깅됩니다
// 자동 로그: 📊 [AutoDI] Current stats: ["UserService": 15, "DataRepository": 8]
```

### ⚠️ 자동 순환 의존성 감지

의존성 등록 시 순환 의존성을 자동으로 감지하고 경고합니다.

```swift
// 순환 의존성이 있다면 자동으로 감지하고 에러 로깅
// 자동 로그: ⚠️ Auto detected circular dependencies: {ServiceA, ServiceB}
```

## API 참조

### 자동 수집 정보 확인

```swift
// 🔄 자동 생성된 의존성 그래프
UnifiedDI.autoGraph

// ⚡ 자동 최적화된 타입들
UnifiedDI.optimizedTypes

// 📊 자동 수집된 사용 통계
UnifiedDI.stats

// ⚠️ 자동 감지된 순환 의존성
UnifiedDI.circularDependencies

// 🎯 Actor 최적화 제안 목록
UnifiedDI.actorOptimizations

// 🔒 타입 안전성 이슈 목록
UnifiedDI.typeSafetyIssues

// 🛠️ 자동 수정된 타입들
UnifiedDI.autoFixedTypes

// ⚡ Actor hop 통계
UnifiedDI.actorHopStats

// 📊 비동기 성능 통계 (밀리초)
UnifiedDI.asyncPerformanceStats
```

### 최적화 제어

```swift
// 자동 최적화 비활성화 (기본값: true)
UnifiedDI.setAutoOptimization(false)

// 특정 타입의 최적화 상태 확인
UnifiedDI.isOptimized(UserService.self)

// 통계 초기화
UnifiedDI.resetStats()
```

### 로깅 레벨 제어

**기본값**: 모든 로그가 활성화되어 있습니다 (`.all`)

#### 사용 시나리오별 설정:

```swift
// ✅ 기본 상태: 모든 로그 출력 (권장)
// 📊 Auto tracking registration: UserService
// ⚡ Auto optimized: UserService (10 uses)
// 📊 [AutoDI] Current stats: {...}

// 📝 등록된 의존성만 보고 싶은 경우
UnifiedDI.setLogLevel(.registration)
// 📊 Auto tracking registration: UserService (등록 로그만)

// ⚡ 성능 최적화 정보만 보고 싶은 경우
UnifiedDI.setLogLevel(.optimization)
// ⚡ Auto optimized: UserService (10 uses) (최적화 로그만)

// ⚠️ 순환 의존성 에러만 보고 싶은 경우
UnifiedDI.setLogLevel(.errors)
// ⚠️ Auto detected circular dependencies: {...} (에러만)

// 🔇 모든 자동 로깅을 끄고 싶은 경우
UnifiedDI.setLogLevel(.off)
// (로그 없음)

// 🔄 기본값으로 되돌리기
UnifiedDI.setLogLevel(.all)

// 📋 현재 설정 확인
Log.debug("현재 로깅 레벨: \(UnifiedDI.logLevel)")
```

## 주요 특징

- **무설정**: 별도 설정 없이 자동으로 동작
- **백그라운드 실행**: 성능에 영향 없이 백그라운드에서 실행
- **실시간 업데이트**: 30초마다 자동으로 최적화 수행
- **메모리 효율적**: 상위 20개 타입만 캐시에 유지

## 성능 영향

자동화 시스템은 성능에 최소한의 영향만 미치도록 설계되었습니다:

- 등록/해결 시 마이크로초 단위의 오버헤드만 발생
- 백그라운드에서 비동기로 실행
- 메모리 사용량 최적화

이 모든 기능은 개발자가 별도로 호출하거나 설정할 필요 없이 자동으로 실행됩니다.
## Deprecated 읽기 API 안내

아래 `AutoDIOptimizer`의 읽기용 API는 내부 스냅샷 기반으로 재구성되었으며, 외부 사용은 비권장(Deprecated)입니다. 외부에서는 `UnifiedDI` 또는 `DIContainer`의 동기 헬퍼를 사용하세요.

| Deprecated (AutoDIOptimizer) | Replacement |
|---|---|
| `getCurrentStats()` | `UnifiedDI.stats()` / `DIContainer.getUsageStatistics()` |
| `visualizeGraph()` | `UnifiedDI.autoGraph()` / `DIContainer.getAutoGeneratedGraph()` |
| `getFrequentlyUsedTypes()` | `UnifiedDI.optimizedTypes()` / `DIContainer.getOptimizedTypes()` |
| `getDetectedCircularDependencies()` | `UnifiedDI.circularDependencies()` / `DIContainer.getDetectedCircularDependencies()` |
| `isOptimized(_:)` | `UnifiedDI.isOptimized(_:)` / `DIContainer.isAutoOptimized(_:)` |
| `getActorOptimizationSuggestions()` | `UnifiedDI.actorOptimizations` |
| `getDetectedTypeSafetyIssues()` | `UnifiedDI.typeSafetyIssues` |
| `getDetectedAutoFixedTypes()` | `UnifiedDI.autoFixedTypes` |
| `getActorHopStats()` | `UnifiedDI.actorHopStats` |
| `getAsyncPerformanceStats()` | `UnifiedDI.asyncPerformanceStats` |
| `getRecentGraphChanges(...)` | `UnifiedDI.getGraphChanges(...)` |
| `getCurrentLogLevel()` | `UnifiedDI.logLevel` / `UnifiedDI.getLogLevel()` |

> 내부 용도로는 `AutoDIOptimizer.readSnapshot()`을 사용해 스냅샷을 읽고 필요한 정보를 계산하세요.
